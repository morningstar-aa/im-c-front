name: Package Application

on:
  push:
    branches: [ "master", "main" ]
  pull_request:
    branches: [ "master", "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v4

    - name: Add MSBuild to PATH
      uses: microsoft/setup-msbuild@v2

    - name: Build Solution
      run: msbuild nim_win_demo/nim.sln /p:Configuration=Release /p:Platform=Win32 /p:PlatformToolset=v142
      # 注意：原始项目使用的是 v120_xp，GitHub Actions 运行器可能不支持。
      # 这里尝试改为 v142 (VS 2019)，如果构建失败，可能需要进一步调整。

    - name: Install Inno Setup
      run: choco install innosetup

    - name: Build Installer
      run: |
        "C:\Program Files (x86)\Inno Setup 6\ISCC.exe" @publish/default.iss
      
    - name: Upload Installer Artifact
      uses: actions/upload-artifact@v4
      with:
        name: parrot-v2-installer
        path: "@publish/*.exe"
